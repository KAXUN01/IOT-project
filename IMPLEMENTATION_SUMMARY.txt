â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   NETWORK TOPOLOGY REVOKED DEVICES - RED FIX                   â•‘
â•‘                             IMPLEMENTATION SUMMARY                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Date: January 4, 2026
âœ… Status: COMPLETE AND TESTED
ğŸ¯ Objective: Show revoked devices in RED color in network topology view

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              PROBLEM FIXED                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BEFORE:
   When a device certificate was revoked, there was no visual indication in the
   network topology view. Users couldn't tell which devices were revoked.

AFTER:
   Revoked devices now appear in CRIMSON RED color (#dc143c) with no connection
   line to the gateway, making it immediately clear they've been revoked.

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            IMPLEMENTATION DETAILS                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£  BACKEND: controller.py

   âœ… Lines 2006-2039: /api/certificates/<device_id>/revoke endpoint
      
      Action: Update device status to 'revoked' and clear tracking data
      
      Code changes:
      â”œâ”€ onboarding.identity_db.update_device_status(device_id, 'revoked')
      â”œâ”€ del last_seen[device_id]
      â”œâ”€ del device_tokens[device_id]
      â”œâ”€ del device_data[device_id]
      â””â”€ del packet_counts[device_id]
      
      Result: Device is marked as revoked in database and can't send data

   âœ… Lines 780-814: /get_topology_with_mac endpoint
      
      Change: Include revoked devices in response (don't skip them)
      
      Code logic:
      â”œâ”€ Adds revoked device to topology["nodes"]
      â”œâ”€ Sets device status to 'revoked'
      â”œâ”€ SKIPS creating edge to gateway (if device_status != 'revoked')
      â””â”€ Returns complete topology with revoked devices visible but disconnected
      
      Result: Frontend receives revoked devices with status='revoked'

2ï¸âƒ£  FRONTEND: templates/dashboard.html

   âœ… Lines 1685-1710: Group styling for 'revoked' status
      
      Styling applied to revoked devices:
      â”œâ”€ Border color: #8b0000 (dark red)
      â”œâ”€ Background: #dc143c (crimson red) â† MAIN COLOR
      â”œâ”€ Highlight: #ff4747 (lighter red)
      â””â”€ Applied when node.group === 'revoked'
      
      Result: Revoked devices display in distinctive crimson red

   âœ… Lines 1968-1982: updateTopology() function
      
      Enhancement: Detects revoked devices and applies styling
      
      Logic:
      â”œâ”€ if (node.status === 'revoked')
      â”œâ”€   assign group: 'revoked'
      â”œâ”€   set title: "Status: REVOKED"
      â””â”€   apply red color styling
      
      Result: Revoked nodes get red color from group styling

   âœ… Lines 2879-2908: revokeCertificate() function
      
      Change: Show device in red instead of removing it
      
      Flow:
      â”œâ”€ POST /api/certificates/{deviceId}/revoke
      â”œâ”€ Success? Show alert "Certificate revoked"
      â”œâ”€ Fetch /get_topology_with_mac
      â”œâ”€ Call updateTopology() to refresh display
      â””â”€ Device now appears in red with tooltip
      
      Result: Instant visual feedback, device turns red

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            VISUAL REFERENCE                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

NETWORK TOPOLOGY COLOR MEANINGS:

   ğŸŸ¢ GREEN (#4caf50)
   â”œâ”€ Status: Active/Online
   â”œâ”€ Connection: Has line to Gateway
   â””â”€ Behavior: Can send/receive data

   ğŸ”´ RED (#f44336)
   â”œâ”€ Status: Inactive/Offline
   â”œâ”€ Connection: No line to Gateway
   â””â”€ Behavior: Data rejected, may reconnect later

   ğŸ”´ CRIMSON RED (#dc143c)
   â”œâ”€ Status: REVOKED (darker than inactive)
   â”œâ”€ Connection: No line to Gateway
   â””â”€ Behavior: Cannot reconnect, certificate invalid

   ğŸŸ¡ GOLD (#ffd700)
   â”œâ”€ Status: Honeypot Redirected
   â”œâ”€ Connection: Has line (to honeypot)
   â””â”€ Behavior: Suspicious device captured

EXAMPLE TOPOLOGY AFTER REVOCATION:

   Before:                          After:
   
   Sensor_A (Green) â”€â”€â”            Sensor_A (Crimson Red) [no line]
   Sensor_B (Green) â”€â”€â”¼â”€ Gateway    Sensor_B (Green) â”€â”€â”
   Sensor_C (Green) â”€â”€â”˜             Sensor_C (Green) â”€â”€â”¼â”€ Gateway
                                   
   All connected                    Sensor_A revoked, others connected

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          USER EXPERIENCE FLOW                                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Step 1: User Action
   â””â”€ Clicks "Revoke" button on device certificate
      (or navigates to certificate management)

Step 2: Confirmation
   â””â”€ Dialog: "Revoke certificate for Sensor_A?"

Step 3: Backend Processing (200ms)
   â””â”€ POST /api/certificates/Sensor_A/revoke
      â”œâ”€ Database: Mark status='revoked'
      â”œâ”€ Memory: Clear all tracking data
      â””â”€ Response: success=true

Step 4: Frontend Update (milliseconds)
   â””â”€ Success alert shown
   â””â”€ Fetch /get_topology_with_mac
   â””â”€ Call updateTopology()
   â””â”€ Device CHANGES TO CRIMSON RED
   â””â”€ Connection line to gateway DISAPPEARS
   â””â”€ Tooltip shows "Status: REVOKED"

Step 5: Audit Trail
   â””â”€ Device remains visible in red
   â””â”€ Users can see which devices were revoked
   â””â”€ Persists across page refresh

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              FILES MODIFIED                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Modified: controller.py
â”œâ”€ Lines 780-814: Include revoked devices in topology response
â””â”€ Lines 2006-2039: Mark device as revoked and clear tracking

Modified: templates/dashboard.html
â”œâ”€ Lines 1685-1710: Add crimson red styling for 'revoked' group
â”œâ”€ Lines 1968-1982: Detect revoked status and apply styling
â””â”€ Lines 2879-2908: Update revoke function to refresh topology

Modified: TOPOLOGY_SYNC_FIX.md
â””â”€ Updated documentation with new approach

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            HOW TO TEST THE FIX                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Quick Test (2 minutes):

1. Open dashboard:
   â†’ http://localhost:5000/

2. Observe network topology:
   â†’ Look for green devices (active)
   â†’ Note their connections to gateway

3. Find and revoke a device:
   â†’ Click certificate management area
   â†’ Find a device (e.g., Sensor_A)
   â†’ Click "Revoke" button
   â†’ Confirm dialog

4. Observe change:
   â†’ Device immediately turns CRIMSON RED
   â†’ Connection line to gateway disappears
   â†’ Other devices remain GREEN
   â†’ Alert shows "Certificate revoked"

5. Verify persistence:
   â†’ Wait 5 seconds
   â†’ Device stays RED
   â†’ Refresh page (F5)
   â†’ Device still shows as RED

âœ… If device appears in crimson red â†’ FIX IS WORKING

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              KEY BENEFITS                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Clear Visibility
   - Revoked devices are visible, not hidden
   - Users understand device status immediately
   - Professional appearance

âœ… Audit Trail
   - Can see which devices are revoked
   - Maintains historical context
   - Security best practice

âœ… Instant Feedback
   - No waiting for 5-second poll
   - Device turns red immediately
   - Responsive user interface

âœ… Backend Security
   - Device can't reconnect after revocation
   - Tokens are invalid
   - Tracking data cleared
   - Database status persistent

âœ… Color-Coded Status
   - Green = OK (active)
   - Red = Caution (offline)
   - Crimson Red = Alert (revoked)
   - Easy to understand at a glance

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          BACKWARD COMPATIBILITY                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… No API changes
âœ… No database schema changes
âœ… No breaking changes to existing code
âœ… Graceful styling for all status values
âœ… Works with existing device table
âœ… Compatible with previous versions

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                               SUMMARY                                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BEFORE:     Device revoked â†’ No visual indication â†’ Confusing for users
AFTER:      Device revoked â†’ Appears in RED color â†’ Clear, professional

CHANGES:    3 files modified, minimal code additions
TESTING:    Manual test confirms red color appears correctly
STATUS:     âœ… READY FOR PRODUCTION

Implementation complete. Revoked devices now appear in crimson red (#dc143c) in
the network topology view, providing clear visual feedback and maintaining an
audit trail of revoked devices.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
